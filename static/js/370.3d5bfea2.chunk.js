"use strict";(self.webpackChunktalking_web=self.webpackChunktalking_web||[]).push([[370],{370:(e,t,n)=>{n.r(t),n.d(t,{default:()=>O});var s=n(555),a=n(43),i=n(184),l=n(200),r=n(434),c=n(472),o=n(260),d=n(791);async function u(e){if(!e)throw new Error("Invalid tenantId");try{const t=(0,c.rJ)(d.db,"users",e,"bill");return(await(0,c.GG)(t)).docs.map((e=>(0,s.A)({id:e.id},e.data())))}catch(t){throw console.error("Error fetching bills:",t),t}}var h,m="basil",x="https://js.stripe.com",j="".concat(x,"/").concat(m,"/stripe.js"),p=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,b=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,v="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",y=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(j).concat(t);var s=document.head||document.body;if(!s)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(n),n},f=null,g=null,N=null,w=function(e){return null!==f?f:(f=new Promise((function(t,n){if("undefined"!==typeof window&&"undefined"!==typeof document)if(window.Stripe&&e&&console.warn(v),window.Stripe)t(window.Stripe);else try{var s=function(){for(var e,t=document.querySelectorAll('script[src^="'.concat(x,'"]')),n=0;n<t.length;n++){var s=t[n];if(e=s.src,p.test(e)||b.test(e))return s}return null}();if(s&&e)console.warn(v);else if(s){if(s&&null!==N&&null!==g){var a;s.removeEventListener("load",N),s.removeEventListener("error",g),null===(a=s.parentNode)||void 0===a||a.removeChild(s),s=y(e)}}else s=y(e);N=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}}(t,n),g=function(e){return function(t){e(new Error("Failed to load Stripe.js",{cause:t}))}}(n),s.addEventListener("load",N),s.addEventListener("error",g)}catch(i){return void n(i)}else t(null)}))).catch((function(e){return f=null,Promise.reject(e)}))},S=!1,C=function(){return h||(h=w(null).catch((function(e){return h=null,Promise.reject(e)})))};Promise.resolve().then((function(){return C()})).catch((function(e){S||console.warn(e)}));var P=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];S=!0;var s=Date.now();return C().then((function(e){return function(e,t,n){if(null===e)return null;var s=t[0].match(/^pk_test/),a=function(e){return 3===e?"v3":e}(e.version),i=m;s&&a!==i&&console.warn("Stripe.js@".concat(a," was loaded on the page, but @stripe/stripe-js@").concat("7.8.0"," expected Stripe.js@").concat(i,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var l=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"7.8.0",startTime:t})}(l,n),l}(e,t,s)}))},k=n(579);function E(e){let{toasts:t}=e;return(0,k.jsx)("div",{className:"toasts",children:t.map((e=>(0,k.jsx)("div",{className:"toast ".concat(e.type),children:e.message},e.id)))})}const M=new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0});function D(e){return M.format(Number(e||0))}function A(e){let{activePanel:t,onSelect:n}=e;const s=[{id:null,icon:(0,k.jsx)(i.rQ8,{}),label:"Dashboard"},{id:"payments",icon:(0,k.jsx)(i.wTh,{}),label:"Payments"},{id:"houseRent",icon:(0,k.jsx)(i.MxO,{}),label:"House Rent"},{id:"electricity",icon:(0,k.jsx)(i.lHQ,{}),label:"Electricity"},{id:"analytics",icon:(0,k.jsx)(i.qvi,{}),label:"Analytics"},{id:"settings",icon:(0,k.jsx)(i.Pcn,{}),label:"Settings"}];return(0,k.jsxs)("aside",{className:"sidebar",role:"navigation","aria-label":"Quick actions",children:[(0,k.jsx)("h3",{children:"Quick Actions"}),(0,k.jsx)("ul",{className:"quick-action-list",children:s.map((e=>{let{id:s,icon:a,label:i}=e;return(0,k.jsxs)("li",{className:t===s?"active":"",onClick:()=>n(s),role:"button",tabIndex:0,onKeyDown:e=>("Enter"===e.key||" "===e.key)&&n(s),"aria-current":t===s?"page":void 0,children:[a," ",i]},i)}))})]})}function F(e){let{bill:t,processing:n,statusMessage:s,onClose:l,handlePayment:r}=e;const c=(0,a.useRef)(null),o=(0,a.useRef)(null),d=(0,a.useRef)(null);(0,a.useEffect)((()=>{const e=c.current;if(!e)return;const t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');t.length&&(o.current=t[0],d.current=t[t.length-1],o.current.focus());const s=e=>{if("Tab"!==e.key)return;const t=e.shiftKey;document.activeElement===o.current&&t?(e.preventDefault(),d.current.focus()):document.activeElement!==d.current||t||(e.preventDefault(),o.current.focus())},a=e=>{"Escape"!==e.key||n||l()};return document.addEventListener("keydown",s),document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",s),document.removeEventListener("keydown",a)}}),[n,l]);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:"modal-overlay",onClick:()=>!n&&l(),"aria-hidden":"true"}),(0,k.jsxs)("div",{className:"payment-modal fade-in-down",role:"dialog","aria-modal":"true",ref:c,children:[(0,k.jsxs)("div",{className:"modal-header",children:[(0,k.jsxs)("h3",{children:["Pay \u20b9",t.amount]}),(0,k.jsx)("button",{onClick:l,disabled:n,"aria-label":"Close",children:(0,k.jsx)(i.QCr,{})})]}),(0,k.jsxs)("div",{className:"modal-body",children:[(0,k.jsxs)("p",{children:[(0,k.jsx)("strong",{children:"Due:"})," ",t.billFor]}),(0,k.jsx)("p",{children:"Pay securely using Google Pay."}),s&&(0,k.jsx)("p",{className:"status-msg",children:s})]}),(0,k.jsxs)("div",{className:"modal-footer",children:[(0,k.jsx)("button",{className:"btn-cancel",onClick:l,disabled:n,children:"Cancel"}),(0,k.jsx)("button",{className:"btn-confirm ".concat(n?"btn-loading":""),onClick:async()=>{n||(await r(t),l())},disabled:n,children:n?"Processing...":"Pay with Google Pay"})]})]})]})}const L=e=>{let{meta:t,onClose:n}=e;return(0,a.useEffect)((()=>{const e=e=>"Escape"===e.key&&(null===n||void 0===n?void 0:n());return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[n]),(0,k.jsx)("div",{className:"success-overlay",role:"dialog","aria-modal":"true",onClick:n,children:(0,k.jsxs)("div",{className:"success-modal",onClick:e=>e.stopPropagation(),children:[(0,k.jsx)("div",{className:"success-icon-wrap",children:(0,k.jsxs)("svg",{className:"success-ring",viewBox:"0 0 120 120",children:[(0,k.jsx)("circle",{className:"ring-bg",cx:"60",cy:"60",r:"54"}),(0,k.jsx)("circle",{className:"ring-fg",cx:"60",cy:"60",r:"54"}),(0,k.jsx)("path",{className:"check",d:"M40 64 L55 78 L82 48",fill:"none",strokeLinecap:"round"})]})}),(0,k.jsx)("h3",{className:"success-title",children:"Payment successful"}),t&&(0,k.jsxs)("p",{className:"success-subtitle",children:[t.type," \u2022 ",t.month," ",t.year,(0,k.jsx)("br",{}),(0,k.jsx)("strong",{children:D(t.amount||0)})]}),(0,k.jsx)("button",{className:"btn btn-primary success-close",onClick:n,children:"Close"})]})})};function R(e){let{bills:t}=e;const n=(0,a.useMemo)((()=>t.filter((e=>"rent"===e.type&&"Paid"!==e.status)).reduce(((e,t)=>e+t.amount),0)),[t]),s=(0,a.useMemo)((()=>t.filter((e=>"electricity"===e.type&&"Paid"!==e.status)).reduce(((e,t)=>e+t.amount),0)),[t]),i=(0,a.useMemo)((()=>t.filter((e=>"Paid"!==e.status)).sort(((e,t)=>new Date(e.billFor)-new Date(t.billFor)))[0]),[t]);return(0,k.jsxs)("div",{className:"feature-panel fade-in",children:[(0,k.jsx)("h2",{children:"Dashboard Overview"}),(0,k.jsxs)("div",{className:"summary-cards",children:[(0,k.jsxs)("div",{className:"card",children:[(0,k.jsx)("h4",{children:"Rent Due"}),(0,k.jsx)("p",{children:D(n)})]}),(0,k.jsxs)("div",{className:"card",children:[(0,k.jsx)("h4",{children:"Electricity Due"}),(0,k.jsx)("p",{children:D(s)})]}),(0,k.jsxs)("div",{className:"card",children:[(0,k.jsx)("h4",{children:"Upcoming Bill"}),(0,k.jsx)("p",{children:(null===i||void 0===i?void 0:i.billFor)||"None"})]})]})]})}function I(e){let{bills:t}=e;const[n,s]=(0,a.useState)("all"),i=(0,a.useMemo)((()=>[...t].sort(((e,t)=>new Date(t.billFor)-new Date(e.billFor)))),[t]),l=(0,a.useMemo)((()=>i.filter((e=>"all"===n||("paid"===n?"Paid"===e.status:"Paid"!==e.status)))),[i,n]),[r,c]=(0,a.useState)(1),o=5*r,d=o-5,u=l.slice(d,o),h=Math.ceil(l.length/5);return(0,k.jsxs)("div",{className:"feature-panel fade-in",children:[(0,k.jsxs)("div",{className:"panel-head",children:[(0,k.jsx)("h2",{children:"All Bills"}),(0,k.jsxs)("select",{value:n,onChange:e=>{s(e.target.value),c(1)},children:[(0,k.jsx)("option",{value:"all",children:"All"}),(0,k.jsx)("option",{value:"due",children:"Due"}),(0,k.jsx)("option",{value:"paid",children:"Paid"})]})]}),l.length?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:"table-container",children:(0,k.jsxs)("table",{className:"feature-table",children:[(0,k.jsx)("thead",{children:(0,k.jsxs)("tr",{children:[(0,k.jsx)("th",{children:"Month"}),(0,k.jsx)("th",{children:"Type"}),(0,k.jsx)("th",{children:"Amount"}),(0,k.jsx)("th",{children:"Due"}),(0,k.jsx)("th",{children:"Status"}),(0,k.jsx)("th",{children:"Action"})]})}),(0,k.jsx)("tbody",{children:u.map((e=>(0,k.jsxs)("tr",{children:[(0,k.jsxs)("td",{children:[e.month," ",e.year]}),(0,k.jsx)("td",{children:e.type}),(0,k.jsx)("td",{children:D(e.amount)}),(0,k.jsx)("td",{children:e.billFor}),(0,k.jsx)("td",{className:"Paid"===e.status?"paid":"due",children:(0,k.jsx)("span",{className:"badge ".concat("Paid"===e.status?"paid":"due"),children:e.status})}),(0,k.jsx)("td",{children:(0,k.jsx)("span",{style:{opacity:.6},children:"\u2014"})})]},e.id)))})]})}),(0,k.jsxs)("div",{className:"pagination",children:[(0,k.jsx)("button",{onClick:()=>c((e=>Math.max(e-1,1))),disabled:1===r,"aria-label":"Previous page",children:(0,k.jsx)("svg",{width:"20",height:"20",fill:"currentColor",viewBox:"0 0 20 20",children:(0,k.jsx)("path",{d:"M12.293 16.293a1 1 0 010-1.414L16.586 10 12.293 5.707a1 1 0 011.414-1.414L18.414 10l-4.707 4.707a1 1 0 01-1.414 0z",transform:"rotate(180 10 10)"})})}),(0,k.jsxs)("span",{children:[r," / ",h]}),(0,k.jsx)("button",{onClick:()=>c((e=>Math.min(e+1,h))),disabled:r===h,"aria-label":"Next page",children:(0,k.jsx)("svg",{width:"20",height:"20",fill:"currentColor",viewBox:"0 0 20 20",children:(0,k.jsx)("path",{d:"M12.293 16.293a1 1 0 010-1.414L16.586 10 12.293 5.707a1 1 0 011.414-1.414L18.414 10l-4.707 4.707a1 1 0 01-1.414 0z"})})})]})]}):(0,k.jsx)("p",{className:"no-bills",children:"No bills found"})]})}function T(e){let{bills:t=[],type:n="rent",openModal:s}=e;const[l,r]=(0,a.useState)(""),[c,o]=(0,a.useState)(""),[d,u]=(0,a.useState)(1),h=["January","February","March","April","May","June","July","August","September","October","November","December"],m=(0,a.useMemo)((()=>{const e={};return h.forEach(((t,n)=>{e[t.toLowerCase()]=n,e[t.slice(0,3).toLowerCase()]=n})),e}),[]),x=e=>{var t;if(!e)return-1;const n=String(e).toLowerCase().trim();return null!==(t=m[n])&&void 0!==t?t:-1},j=(0,a.useMemo)((()=>t.filter((e=>e.type===n&&(!l||String(e.month).trim()===l)&&(!c||String(e.year)===String(c))&&"Paid"!==e.status)).sort(((e,t)=>{const n=Number(e.year)||0,s=Number(t.year)||0;if(n!==s)return n-s;return x(e.month)-x(t.month)}))),[t,n,l,c,m]),p=Math.max(1,Math.ceil(j.length/10));(0,a.useEffect)((()=>{d>p&&u(p)}),[p,d]);const b=Math.min(d,p),v=(0,a.useMemo)((()=>{const e=10*(b-1);return j.slice(e,e+10)}),[j,b]);return(0,k.jsxs)("div",{className:"bill-list-container",children:[(0,k.jsx)("h2",{className:"form-heading",children:"rent"===n?"House Rent Bills":"Electricity Bills"}),(0,k.jsxs)("div",{className:"filters-row",children:[(0,k.jsxs)("select",{className:"select",value:l,onChange:e=>{r(e.target.value),u(1)},children:[(0,k.jsx)("option",{value:"",children:"All Months"}),h.map((e=>(0,k.jsx)("option",{value:e,children:e},e)))]}),(0,k.jsxs)("select",{className:"select",value:c,onChange:e=>{o(e.target.value),u(1)},children:[(0,k.jsx)("option",{value:"",children:"All Years"}),[2023,2024,2025].map((e=>(0,k.jsx)("option",{value:e,children:e},e)))]}),(0,k.jsx)("button",{className:"btn",onClick:()=>{r(""),o(""),u(1)},children:"Reset"})]}),v.length>0?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:"tenant-table bill-table",children:(0,k.jsx)("div",{className:"table-wrapper",children:(0,k.jsxs)("table",{className:"table",children:[(0,k.jsx)("thead",{className:"thead",children:(0,k.jsxs)("tr",{children:[(0,k.jsx)("th",{children:"Month"}),(0,k.jsx)("th",{className:"ta-right",children:"Amount"}),"electricity"===n&&(0,k.jsx)("th",{className:"ta-right",children:"Last Unit"}),"electricity"===n&&(0,k.jsx)("th",{className:"ta-right",children:"Current Unit"}),"electricity"===n&&(0,k.jsx)("th",{className:"ta-right",children:"Rate/Unit"}),(0,k.jsx)("th",{children:"Due For"}),(0,k.jsx)("th",{children:"Note"}),(0,k.jsx)("th",{children:"Status"}),(0,k.jsx)("th",{children:"Action"})]})}),(0,k.jsx)("tbody",{className:"tbody",children:v.map((e=>{return(0,k.jsxs)("tr",{children:[(0,k.jsxs)("td",{children:[e.month," ",e.year]}),(0,k.jsx)("td",{className:"ta-right",children:(t=e.amount,"\u20b9".concat(Number(t||0).toLocaleString("en-IN")))}),"electricity"===n&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("td",{className:"ta-right",children:Number.isFinite(Number(e.lastUnit))?Number(e.lastUnit):"-"}),(0,k.jsx)("td",{className:"ta-right",children:Number.isFinite(Number(e.currentUnit))?Number(e.currentUnit):"-"}),(0,k.jsx)("td",{className:"ta-right",children:Number.isFinite(Number(e.ratePerUnit))?"\u20b9".concat(Number(e.ratePerUnit)):"-"})]}),(0,k.jsx)("td",{children:e.billFor||"-"}),(0,k.jsx)("td",{children:e.note||"-"}),(0,k.jsx)("td",{className:"Paid"===e.status?"paid":"due",children:e.status}),(0,k.jsx)("td",{children:(0,k.jsx)("button",{className:"btn btn-small btn-primary",onClick:()=>s(e),children:"Pay Now"})})]},e.id);var t}))})]})})}),(0,k.jsxs)("div",{className:"pagination",children:[(0,k.jsx)("button",{className:"btn btn-icon",disabled:b<=1,style:{width:65},onClick:()=>u((e=>Math.max(1,e-1))),"aria-label":"Previous page",children:(0,k.jsx)(i._Jj,{style:{color:"#fff"}})}),(0,k.jsxs)("span",{className:"page-indicator",children:[b,"/",p]}),(0,k.jsx)("button",{className:"btn btn-icon",style:{width:65},disabled:b>=p,onClick:()=>u((e=>Math.min(p,e+1))),"aria-label":"Next page",children:(0,k.jsx)(i.X6T,{})})]})]}):(0,k.jsx)("div",{className:"no-bills",children:"No pending bills found."})]})}function U(e){let{bills:t}=e;const n=(0,a.useMemo)((()=>t.reduce(((e,t)=>(e.total+=t.amount,"Paid"===t.status?(e.paid+=t.amount,e.countPaid+=1):(e.due+=t.amount,e.countDue+=1),"rent"===t.type&&(e.rent+=t.amount),"electricity"===t.type&&(e.electricity+=t.amount),e)),{total:0,paid:0,due:0,rent:0,electricity:0,countPaid:0,countDue:0})),[t]);return(0,k.jsxs)("div",{className:"feature-panel fade-in",children:[(0,k.jsx)("h2",{children:"Analytics"}),(0,k.jsxs)("div",{className:"summary-cards",children:[(0,k.jsxs)("div",{className:"card",children:[(0,k.jsx)("h4",{children:"Total"}),(0,k.jsx)("p",{children:D(n.total)})]}),(0,k.jsxs)("div",{className:"card",children:[(0,k.jsx)("h4",{children:"Paid"}),(0,k.jsxs)("p",{children:[D(n.paid)," \u2022 ",n.countPaid," bills"]})]}),(0,k.jsxs)("div",{className:"card",children:[(0,k.jsx)("h4",{children:"Due"}),(0,k.jsxs)("p",{children:[D(n.due)," \u2022 ",n.countDue," bills"]})]}),(0,k.jsxs)("div",{className:"card",children:[(0,k.jsx)("h4",{children:"Rent"}),(0,k.jsx)("p",{children:D(n.rent)})]}),(0,k.jsxs)("div",{className:"card",children:[(0,k.jsx)("h4",{children:"Electricity"}),(0,k.jsx)("p",{children:D(n.electricity)})]})]})]})}function q(e){let{userData:t,onSaved:n,onError:i}=e;const[l,r]=(0,a.useState)({name:(null===t||void 0===t?void 0:t.name)||"",email:(null===t||void 0===t?void 0:t.email)||"",contact:(null===t||void 0===t?void 0:t.contact)||""}),[o,u]=(0,a.useState)(!1);(0,a.useEffect)((()=>{r({name:(null===t||void 0===t?void 0:t.name)||"",email:(null===t||void 0===t?void 0:t.email)||"",contact:(null===t||void 0===t?void 0:t.contact)||""})}),[t]);const h=e=>{const{name:t,value:n}=e.target;r((e=>(0,s.A)((0,s.A)({},e),{},{[t]:n})))};return(0,k.jsxs)("div",{className:"feature-panel fade-in",children:[(0,k.jsx)("h2",{children:"Settings"}),(0,k.jsxs)("form",{className:"settings-form",onSubmit:async e=>{e.preventDefault();if(l.name.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.email)&&/^[0-9]{10}$/.test(l.contact)){if(null!==t&&void 0!==t&&t.uid){u(!0);try{await(0,c.mZ)((0,c.H9)(d.db,"users",t.uid),{name:l.name.trim(),email:l.email.trim(),contact:l.contact.trim()}),null===n||void 0===n||n("Changes saved")}catch(s){null===i||void 0===i||i("Failed to save changes")}finally{u(!1)}}}else null===i||void 0===i||i("Please enter a valid name, email, and 10-digit phone number.")},children:[(0,k.jsxs)("label",{children:["Name: ",(0,k.jsx)("input",{name:"name",type:"text",value:l.name,onChange:h,required:!0})]}),(0,k.jsxs)("label",{children:["Email: ",(0,k.jsx)("input",{name:"email",type:"email",value:l.email,onChange:h,required:!0})]}),(0,k.jsxs)("label",{children:["Phone: ",(0,k.jsx)("input",{name:"contact",type:"tel",value:l.contact,onChange:h,required:!0})]}),(0,k.jsx)("button",{type:"submit",disabled:o,"aria-busy":o,children:o?"Saving...":"Save Changes"})]})]})}function O(e){let{tenantId:t}=e;const[n,h]=(0,a.useState)(null),[m,x]=(0,a.useState)([]),[j,p]=(0,a.useState)(null),[b,v]=(0,a.useState)(null),[y,f]=(0,a.useState)(""),[g,N]=(0,a.useState)(!1),[w,S]=(0,a.useState)(!0),[C,M]=(0,a.useState)(""),[D,O]=(0,a.useState)(!1),{width:Q}=function(){const[e,t]=(0,a.useState)({width:"undefined"!==typeof window?window.innerWidth:1024,height:"undefined"!==typeof window?window.innerHeight:768});return(0,a.useEffect)((()=>{let e;const n=()=>{clearTimeout(e),e=setTimeout((()=>t({width:window.innerWidth,height:window.innerHeight})),150)};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)}),[]),e}(),_=(0,o.Zp)(),{toasts:z,show:H}=function(){const[e,t]=(0,a.useState)([]),n=(0,a.useCallback)((function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3500;const a=Math.random().toString(36).slice(2);t((t=>[...t,{id:a,message:e,type:n}])),setTimeout((()=>t((e=>e.filter((e=>e.id!==a))))),s)}),[]);return{toasts:e,show:n}}();(0,a.useEffect)((()=>{O(Q>=768)}),[Q]),(0,a.useEffect)((()=>{const e=(0,r.xI)();return(0,r.hg)(e,(async e=>{if(e)try{const t=await(0,c.x7)((0,c.H9)(d.db,"users",e.uid));p((0,s.A)({uid:e.uid},t.data()))}catch(t){M("Failed to fetch user data.")}else _("/login")}))}),[_]),(0,a.useEffect)((()=>{t&&(S(!0),u(t).then((e=>{x(e||[]),M("")})).catch((()=>M("Failed to load bills."))).finally((()=>S(!1))))}),[t]);const J=(0,a.useCallback)((e=>{v(e),f("")}),[]),G=(0,a.useCallback)((()=>{g||v(null)}),[g]),[B,W]=(0,a.useState)(!1),[Y,K]=(0,a.useState)(null);P("pk_test_51RuUuRQOfJEfe6eIyzIDFr7OqoJ3WNfdK02Up87IqJ17XICpsdkMFRuXeE5i8vHeoxSdqiSloEbMSE5LgPmQZzQa00J9tlsFmi");const $=(0,a.useCallback)((async e=>{if(!e)return;const n=e.tenantId||(null===j||void 0===j?void 0:j.uid);if(n)try{const s=new(await new Promise(((e,t)=>{var n,s,a;if(null!==(n=window.google)&&void 0!==n&&null!==(s=n.payments)&&void 0!==s&&null!==(a=s.api)&&void 0!==a&&a.PaymentsClient)return void e(window.google.payments.api.PaymentsClient);const i=document.createElement("script");i.src="https://pay.google.com/gp/p/js/pay.js",i.onload=()=>e(window.google.payments.api.PaymentsClient),i.onerror=t,document.body.appendChild(i)})))({environment:"TEST"}),a={apiVersion:2,apiVersionMinor:0,allowedPaymentMethods:[{type:"CARD",parameters:{allowedAuthMethods:["PAN_ONLY","CRYPTOGRAM_3DS"],allowedCardNetworks:["MASTERCARD","VISA"]},tokenizationSpecification:{type:"PAYMENT_GATEWAY",parameters:{gateway:"example"}}}],merchantInfo:{merchantName:"RentEase"},transactionInfo:{totalPriceStatus:"FINAL",totalPrice:e.amount.toFixed(2),currencyCode:"INR",countryCode:"IN"}},i=await s.loadPaymentData(a);console.log("Google Pay response:",i);const l=i.paymentMethodData.tokenizationData.token;console.log("Token received from Google Pay:",l),await fetch("/your-backend-endpoint",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:l,amount:e.amount})});const r=(0,c.H9)(d.db,"users",n,"bill",e.id);await(0,c.BN)(r,{status:"Paid",paidAt:new Date},{merge:!0});const o=await u(t);x(o||[]),W(!0),H("Payment recorded via Google Pay (Razorpay)","success")}catch(s){console.error("Payment failed:",s);const e=(null===s||void 0===s?void 0:s.message)||"Payment cancelled or failed";H(e,{type:"error",autoClose:!1,closeOnClick:!0,draggable:!0})}else f("Missing tenant ID")}),[j,t,H,x,W,f]),V=(0,a.useMemo)((()=>({null:(0,k.jsx)(R,{bills:m}),payments:(0,k.jsx)(I,{bills:m}),houseRent:(0,k.jsx)(T,{bills:m,type:"rent",openModal:J}),electricity:(0,k.jsx)(T,{bills:m,type:"electricity",openModal:J}),analytics:(0,k.jsx)(U,{bills:m}),settings:(0,k.jsx)(q,{userData:j,onSaved:e=>H(e,"success"),onError:e=>H(e,"error")})})),[m,J,j,H]);return(0,k.jsxs)("div",{className:"tenant-dashboard ".concat(D?"sidebar-open":""),children:[(0,k.jsx)("div",{className:"top-right-actions",children:(0,k.jsx)("button",{className:"logout-btn",onClick:()=>(0,r.CI)((0,r.xI)()).then((()=>_("/login"))),title:"Logout","aria-label":"Logout",children:(0,k.jsx)(l.QeK,{style:{marginRight:"6px"}})})}),(0,k.jsx)(A,{activePanel:n,onSelect:e=>{h(e),Q<768&&O(!1)}}),(0,k.jsx)("main",{className:"dashboard-body",children:w?(0,k.jsx)("div",{className:"loading",children:"Loading\u2026"}):C?(0,k.jsx)("div",{className:"error-msg",children:C}):V[n]}),(0,k.jsxs)("nav",{className:"mobile-nav",children:[(0,k.jsx)("button",{onClick:()=>h(null),title:"Dashboard","aria-label":"Dashboard",children:(0,k.jsx)(i.rQ8,{})}),(0,k.jsx)("button",{onClick:()=>h("payments"),title:"Payments","aria-label":"Payments",children:(0,k.jsx)(i.wTh,{})}),(0,k.jsx)("button",{onClick:()=>h("houseRent"),title:"Rent","aria-label":"Rent",children:(0,k.jsx)(i.MxO,{})}),(0,k.jsx)("button",{onClick:()=>h("electricity"),title:"Electricity","aria-label":"Electricity",children:(0,k.jsx)(i.lHQ,{})}),(0,k.jsx)("button",{onClick:()=>h("settings"),title:"Settings","aria-label":"Settings",children:(0,k.jsx)(i.Pcn,{})})]}),b&&(0,k.jsx)(F,{bill:b,processing:g,statusMessage:y,onClose:G,handlePayment:$}),B&&(0,k.jsx)(L,{meta:Y,onClose:()=>W(!1)}),(0,k.jsx)(E,{toasts:z})]})}}}]);
//# sourceMappingURL=370.3d5bfea2.chunk.js.map